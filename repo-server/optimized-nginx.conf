server {
    listen 80;
    server_name repo.example.com;  # Change to your server hostname or IP

    root /srv/mirror/ubuntu;
    autoindex on;                  # Required for apt
    autoindex_exact_size off;      # Human-readable sizes
    autoindex_localtime on;        # Show file modification time

    # ----------------------------
    # Optimize large file downloads
    # ----------------------------
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    client_max_body_size 2G;       # Support large .deb uploads if needed
    output_buffers 1 16k;

    # ----------------------------
    # Compression for .gz files
    # ----------------------------
    gzip on;
    gzip_types text/plain text/css application/javascript application/x-debian-package application/octet-stream;
    gzip_min_length 256;
    gzip_proxied any;
    gzip_disable "msie6";

    # ----------------------------
    # Caching headers for apt
    # ----------------------------
    location ~* \.(deb|udeb|dsc|tar\.gz|diff|xz|bz2|zst)$ {
        expires max;
        add_header Cache-Control "public";
        access_log off;
    }

    # ----------------------------
    # Directory listing and general access
    # ----------------------------
    location / {
        try_files $uri $uri/ =404;
    }

    # ----------------------------
    # Logging
    # ----------------------------
    access_log /var/log/nginx/repo_access.log;
    error_log /var/log/nginx/repo_error.log;
}
